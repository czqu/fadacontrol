Fix some problem
Improved performance through code optimization